<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article - PT Horizon Solusi Expertindo</title>
    <link rel="stylesheet" href="navbar.css">
    <link rel="stylesheet" href="footer.css">
    <link rel="stylesheet" href="blog.css">
    <link rel="stylesheet" href="article.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

    <!-- ===== HEADER: NAVIGATION BAR ===== -->
    <header>
        <nav class="navbar">
            <div class="navbar-container">
                <div class="navbar-brand">
                    <a href="index.html" class="nav-logo">
                        <img src="logo-type.png" alt="PT Horizon Solusi Expertindo Logo" class="navbar-logo">
                    </a>
                </div>
                <div class="navbar-menu">
                    <ul class="navbar-nav">
                        <li class="nav-item"><a href="about.html" class="nav-link">Tentang Kami</a></li>
                        <li class="nav-item"><a href="services.html" class="nav-link">Layanan</a></li>
                        <li class="nav-item"><a href="blog.html" class="nav-link">Blog</a></li>
                        <li class="nav-item"><a href="gallery.html" class="nav-link">Galeri</a></li>
                    </ul>
                    <a href="index.html#contact" class="btn-contact">Hubungi Kami</a>
                </div>
                <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                    <span></span><span></span><span></span>
                </button>
            </div>
        </nav>
    </header>

    <main id="article-content">
        <!-- Skeleton / Loading State -->
        <div class="article-loading" style="text-align: center; padding: 10rem 2rem;">
            <h2>Loading Article...</h2>
        </div>
    </main>

    <!-- ===== FOOTER ===== -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-column footer-brand">
                <h3 class="footer-brand-title">PT Horizon Solusi Expertindo</h3>
                <p class="footer-brand-text">Pusat pelatihan dan sertifikasi kompetensi terpercaya untuk kemajuan karier
                    dan bisnis Anda.</p>
            </div>

            <div class="footer-column">
                <h4 class="footer-heading">Layanan</h4>
                <ul class="footer-links">
                    <li><a href="services.html" class="footer-link">Pelatihan BNSP</a></li>
                    <li><a href="services.html" class="footer-link">Sertifikasi Kemnaker</a></li>
                    <li><a href="services.html" class="footer-link">Konsultasi K3</a></li>
                </ul>
            </div>

            <div class="footer-column">
                <h4 class="footer-heading">Kontak</h4>
                <ul class="footer-links">
                    <li><a href="mailto:info@horizonexpertindo.com" class="footer-link">Email Kami</a></li>
                    <li><a href="index.html#contact" class="footer-link">Lokasi Kantor</a></li>
                    <li><a href="https://wa.me/628123456789" class="footer-link">WhatsApp</a></li>
                </ul>
            </div>

            <div class="footer-column">
                <h4 class="footer-heading">Perusahaan</h4>
                <ul class="footer-links">
                    <li><a href="about.html" class="footer-link">Tentang Kami</a></li>
                    <li><a href="index.html#blog" class="footer-link">Blog & Artikel</a></li>
                    <li><a href="gallery.html" class="footer-link">Galeri Foto</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script src="navbar.js"></script>
    <script>
        const SUPABASE_URL = 'https://fjzzbrqxkprsxjqlpqly.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_c4qv84Kkzdb6g7KJCnyEfg_eeOEFmfx';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function loadArticle() {
            const urlParams = new URLSearchParams(window.location.search);
            const articleId = urlParams.get('id');

            const container = document.getElementById('article-content');

            if (!articleId) {
                container.innerHTML = `
                    <div style="text-align:center; padding: 10rem 2rem;">
                        <h1 style="font-size: 3rem; margin-bottom: 1rem;">Artikel tidak ditemukan</h1>
                        <p style="font-size: 1.2rem; margin-bottom: 2rem; color: var(--text-secondary);">Parameter ID hilang</p>
                        <a href="blog.html" style="color: var(--primary-color); text-decoration: underline; font-weight: 600;">Kembali ke Blog</a>
                    </div>
                `;
                return;
            }

            try {
                let { data: article, error } = await supabaseClient
                    .from('articles')
                    .select('*')
                    .eq('id', articleId.toString())
                    .single();

                if (error) throw error;

                if (article) {
                    renderArticle(article);
                }
            } catch (err) {
                console.error('Error loading article:', err.message);
                container.innerHTML = `
                    <div style="text-align:center; padding: 10rem 2rem;">
                        <h2 style="margin-bottom: 1rem;">Gagal memuat artikel</h2>
                        <p style="margin-bottom: 2rem;">${err.message}</p>
                        <a href="blog.html" style="color: var(--primary-color); text-decoration: underline;">Kembali ke Blog</a>
                    </div>
                `;
            }
        }

        function convertDriveLink(url) {
            if (!url) return '';
            if (url.includes('drive.google.com')) {
                const idMatch = url.match(/\/d\/(.+?)\//) || url.match(/id=(.+?)(&|$)/);
                if (idMatch && idMatch[1]) {
                    return `https://lh3.googleusercontent.com/u/0/d/${idMatch[1]}`;
                }
            }
            return url;
        }

        function renderArticle(article) {
            const dateParams = { day: 'numeric', month: 'long', year: 'numeric' };
            const formattedDate = new Date(article.published_at).toLocaleDateString('id-ID', dateParams);

            const layout = `
                <article>
                    <header class="article-header">
                        <span class="article-category">${article.category || 'Tanpa Kategori'}</span>
                        <h1 class="article-title">${article.title}</h1>
                        <div class="article-meta">Diterbitkan pada ${formattedDate}</div>
                    </header>
                    
                    <div class="article-hero">
                        <img src="${convertDriveLink(article.thumbnail)}" alt="${article.title}">
                    </div>
                    
                    <div class="article-body">
                        ${article.content}
                    </div>
                </article>
            `;

            document.getElementById('article-content').innerHTML = layout;
            document.title = `${article.title} - PT Horizon Solusi Expertindo`;
        }

        document.addEventListener('DOMContentLoaded', loadArticle);
    </script>
</body>

</html>